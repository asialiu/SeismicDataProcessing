%This is a wrapper function to remove the instrument response from multiple SAC files.
%This function is designed to process a large amount of data sets/sac
%files.
%It calls individual function to process each sac file.
%
datadir='testdata';
respdir=strcat(datadir,'/IRISDMC');

allfiles1=dir([datadir, '/*.sac']);
allfiles2=dir([datadir, '/*.SAC']);
allfiles=[allfiles1;allfiles2];

nfiles=size(allfiles,1);
npoles=2;
freqmin=0.01;
figflag=1;
for i=1%:nfiles
    % read EGF file
    
    filename=allfiles(i).name; 
    
    intrace=readsac([datadir,'/',filename]);
    
    outtrace=rm_resp_sac(intrace,freqmin,npoles,respdir,'SACPZ','.');
    
    outtrace.FILENAME = strcat(intrace.FILENAME,'_test');
    
    writesac(outtrace);
    
    if figflag
        dt=intrace.DELTA;
        tt=intrace.B:dt:intrace.E;
        if length(tt)< intrace.NPTS
            timeflag(1:end-1,i)=tt;
            timeflag(end,i)=dd1.E+dt;
        else
            timeflag(:,i)=tt;
        end
        figure
        hold on;
        plot(
        
        hold off;
        axis on;
        grid on;
        box on;
    end
end

disp(['Removed responses from ',num2str(nfiles),' SAC files']);
